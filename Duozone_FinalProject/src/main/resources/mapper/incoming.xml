<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
           "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.douzone.DAO.IncomingDAO">
	<select id="earner_list" parameterType="java.util.Map"
		resultType="com.douzone.entity.IncomingVO">
		select 
			count(*) as count, t.tax_id, t.accrual_ym, t.payment_ym, t.payment_date, t.total_payment, 
			t.tax_rate, t.repay_amount, t.tax_income, t.tax_local, t.artist_cost, t.ins_cost, t.real_payment,
			e.div_code, e.earner_name, e.personal_no, e.is_native, t.total_payment, t.tax_rate, t.tax_income,
			t.tax_local, t.artist_cost, t.ins_cost 
		from 
			earner e left join earner_tax t 
			on e.worker_id=t.worker_id 
		where 
			e.worker_id=#{worker_id} 
			and ${param1} between to_date(#{param2} ,'YYYYmm') and to_date(#{param3} ,'YYYYmm')
			and e.${param4} like concat('%',#{param5},'%') 
		order by 
			#{param6};
	</select>
	<update id="visible_update">
		update regist_buffer set is_visible='N' where worker_id=#{worker_id} and earner_code=
		<foreach collection="map" index="index" item="earner_code" separator="or">
			${earner_code}
		</foreach>
	</update>
<!-- 	<select id="income_category" parameterType="java.util.Map"
		resultType="com.douzone.entity.IncomingVO">
		select * from earner e left join earner_tax t 
		on e.worker_id=t.worker_id
		where e.worker_id=#{worker_id} and
		${param1} between
		to_date(#{param2} ,'YYYYmm') 
		and to_date(#{param3} ,'YYYYmm')
		and e.div_code like concat('%',#{param4},'%')
		order by #{param5};
	</select> -->
	<insert id="regist" parameterType="java.util.Map">
		<selectKey keyProperty="earnerseq" resultType="String"
			order="BEFORE">
			SELECT earner_no_seq.NEXTVAL AS earnerseq FROM DUAL
		</selectKey>
		insert into earner(earner_no, worker_id, corp_code, earn_div_code,
		earn_code,
		resi_div, nation_div, earner_name, ssn1, ssn2, address,
		address_detail, cable_phone1,
		cell_phone1, email_1, st_loan_yn,
		st_loan_price, etc, )
		values(#{earnerseq}, #{param1},#{param2},#{param3})
	</insert>
	<select id="searchearner" parameterType="java.util.Map"
		resultType="java.util.Map">
		select *
		from earner where earner_no in (
		<foreach collection="map" index="index" item="earner_no" separator=",">
			CAST(#{earner_no} AS INTEGER)
		</foreach>
		)
		ORDER BY earner_no
	</select>

	<select id="test1" parameterType="java.util.Map"
		resultType="java.util.Map">
		select e.earner_no, e.worker_id, test1, test2
		from earner e
		inner join test t on e.earner_no = t.earner_no
	</select>

</mapper>